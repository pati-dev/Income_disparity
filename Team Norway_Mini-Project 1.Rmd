---
title: "Mini-Project 1_Team Norway"
author: "Ankit Mathur"
date: "1/31/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, tidy = TRUE)
library(tidyverse)
library(foreign)
library(data.table)
```

# Correlation b/w mean income and top/bottom ventiles

Load the data
```{r, include=FALSE}
ventile = read.dta("ventile_2011_for_release_LCU.dta")
conv = read.csv("curr_conv.csv", stringsAsFactors = FALSE)
# summary(ventile)
# summary(conv)
```


```{r}
data_prep <- function(ventile.adj, v) {
  # Convert all local currencies to corresponding USD 2012 dollars (not adjusted for inflation)
  ventile.adj <- merge(ventile, conv, by = "contcod", all.x = TRUE)
  ventile.adj$ventile_income_adj = ventile.adj$ventile_income * ventile.adj$conv_fac
  ventile.adj$continent <- replace_na(ventile.adj$continent, "NA")
  
  # Compute % income share of top ventile and average income for each country
  ventile.dt = data.table(ventile.adj)
  setkey(ventile.dt, ventile)
  ventile.v = ventile.dt[ .(v), list(totpop, v_income = ventile_income_adj * pop), by = contcod ]
  ventile.tot = ventile.dt[, list( tot_income = sum(ventile_income_adj * pop) ), by = contcod ]
  ventile.v <- merge(ventile.v, ventile.tot, by = "contcod", all.x = TRUE)
  
  ventile.v$perc_share = ventile.v$v_income * 100 / ventile.v$tot_income
  ventile.v$avg_income = ventile.v$tot_income / ventile.v$totpop
  return(ventile.v)
}
```

Plot % income share of top ventile against average income
```{r}
ventile.top5.mean = aggregate(avg_income ~ perc_share, mean, data = ventile.top5)
ggplot(ventile.top5, aes(x = perc_share, y = avg_income)) +
  geom_point(alpha = 0.2) +
  geom_smooth(aes(fill = "Trend"), color = "#56B4E9", se = FALSE) +
  ylab("Average income") +
  xlab("% income share") +
  ggtitle("Income share of top 5% individuals by mean income of country") +
  labs(subtitle = "N = 72") +
  scale_fill_manual(name = "", values = c("Trend" = "#56B4E9")) +
  theme(legend.position = "bottom")
```

